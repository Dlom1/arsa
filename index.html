<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arsa Manager - Upload & Gallery</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f4f7f6; margin: 0; padding: 20px; }
        .container { max-width: 800px; margin: auto; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { color: #1a73e8; text-align: center; }
        
        /* Area Upload */
        .upload-section { border: 2px dashed #1a73e8; padding: 30px; border-radius: 10px; text-align: center; margin-bottom: 30px; position: relative; }
        .upload-section:hover { background: #f8fbff; }
        input[type="file"] { position: absolute; width: 100%; height: 100%; top: 0; left: 0; opacity: 0; cursor: pointer; }
        #status { margin-top: 10px; font-weight: bold; color: #555; }

        /* Galeri */
        .gallery-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; }
        .photo-card { border: 1px solid #eee; border-radius: 10px; overflow: hidden; background: #fff; }
        .photo-card img { width: 100%; aspect-ratio: 1/1; object-fit: cover; cursor: pointer; }
        .photo-info { padding: 8px; font-size: 11px; text-align: center; background: #fafafa; border-top: 1px solid #eee; }
    </style>
</head>
<body>

<div class="container">
    <h2>Arsa Cloud Manager</h2>
    
    <div class="upload-section">
        <p id="upload-text">Klik atau Taruh Foto untuk Upload ke Repo <strong>arsa</strong></p>
        <input type="file" id="fileInput" accept="image/*">
        <div id="status">Pilih file untuk memulai</div>
    </div>

    <hr>
    <h3>Daftar Foto di Repo</h3>
    <div id="gallery" class="gallery-grid">
        </div>
</div>

<script>
    // KONFIGURASI PENTING
    const USERNAME = 'Dlom1';
    const REPO = 'arsa';
    // Gunakan Fine-grained Token atau Classic Token GitHub Anda di sini
    // PERINGATAN: Menaruh Token di HTML publik berisiko. Gunakan akun khusus atau Token terbatas.
    const GITHUB_TOKEN = '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'; 

    const fileInput = document.getElementById('fileInput');
    const status = document.getElementById('status');
    const gallery = document.getElementById('gallery');

    // 1. FUNGSI UNTUK UPLOAD KE REPO
    fileInput.onchange = async (e) => {
        const file = e.target.files[0];
        if (!file) return;

        status.innerText = "Sedang memproses file...";
        const reader = new FileReader();
        
        reader.onload = async () => {
            const content = reader.result.split(',')[1]; // Ambil Base64
            const fileName = file.name.replace(/\s+/g, '_'); // Hapus spasi di nama file

            status.innerText = `Mengunggah ${fileName} ke GitHub...`;

            try {
                const response = await fetch(`https://api.github.com/repos/${USERNAME}/${REPO}/contents/${fileName}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${GITHUB_TOKEN}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: `Upload foto: ${fileName} via Web`,
                        content: content
                    })
                });

                if (response.ok) {
                    status.innerText = "Berhasil masuk ke Repo arsa!";
                    status.style.color = "green";
                    setTimeout(() => location.reload(), 2000); // Reload untuk update galeri
                } else {
                    const err = await response.json();
                    status.innerText = "Gagal: " + err.message;
                    status.style.color = "red";
                }
            } catch (error) {
                status.innerText = "Kesalahan Koneksi.";
            }
        };
        reader.readAsDataURL(file);
    };

    // 2. FUNGSI UNTUK MENAMPILKAN DAFTAR FOTO
    async function loadGallery() {
        try {
            const res = await fetch(`https://api.github.com/repos/${USERNAME}/${REPO}/contents/`);
            const files = await res.json();
            
            const imageExts = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
            const photos = files.filter(f => imageExts.includes(f.name.split('.').pop().toLowerCase()));

            gallery.innerHTML = photos.length ? '' : 'Belum ada foto.';
            
            photos.forEach(photo => {
                const imgUrl = `https://${USERNAME}.github.io/${REPO}/${photo.name}`;
                const card = document.createElement('div');
                card.className = 'photo-card';
                card.innerHTML = `
                    <img src="${imgUrl}" onclick="window.open('${imgUrl}', '_blank')">
                    <div class="photo-info">${photo.name}</div>
                `;
                gallery.appendChild(card);
            });
        } catch (e) {
            gallery.innerHTML = "Gagal memuat daftar foto.";
        }
    }

    loadGallery();
</script>

</body>
</html>
